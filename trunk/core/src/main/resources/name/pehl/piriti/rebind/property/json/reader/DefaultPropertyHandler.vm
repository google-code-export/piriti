#set($valueType = $property.type.qualifiedSourceName)
#set($parameterizedValueType = $property.type.parameterizedQualifiedSourceName)
#set($value = $property.variables.value)
#set($reader = $property.variables.newVariable("Reader"))
#set($converter = $property.variables.newVariable("Converter"))
#set($jsonValue = $property.variables.newVariable("JsonValue"))
#set($jsonObject = $property.variables.newVariable("JsonObject"))

#logProperty()
#foreach ($concreteType in $property.concreteTypes)
    // if there are any reader / writer definitions in $concreteType.parameterizedQualifiedSourceName, this ensures they are registered
    new ${concreteType.parameterizedQualifiedSourceName}();
#end

$parameterizedValueType $value = null;
JSONValue $jsonValue = null;

#getOrSelectJsonValue()
if ($jsonValue != null)
{
    #if ($property.native)
        #if($TypeUtils.isJsonValue($property.type))
            $value = $jsonValue;
        #elseif($TypeUtils.isJsonValueSubtype($property.type))
            if ($jsonValue instanceof $valueType) 
            {
                $value = ($parameterizedValueType)$jsonValue;
            }
        #else
            if (logger.isLoggable(SEVERE)) 
            {
                logger.log(SEVERE, "Cannot map property $property.name in ${modelType} nativly: Type $parameterizedValueType must be an instance of JSONValue.");
            }
        #end
    #else
		JsonReader<$parameterizedValueType> $reader = jsonRegistry.getReader(${valueType}.class);
		if ($reader != null)
		{
            JSONObject $jsonObject = ${jsonValue}.isObject();
            if ($jsonObject != null)
            {
                $value = ${reader}.read($jsonObject);
            }
		}
		else
		{
		    if (${jsonValue}.isNull() == null) 
		    {
		        JSONString jsonString = ${jsonValue}.isString();
		        if (jsonString != null)
		        {
		            String stringValue = jsonString.stringValue();
		            if (stringValue != null)
		            {
			            Converter<$parameterizedValueType> $converter = null;
			            #if ($property.hasConverter()) #customConverter() #else #defaultConverter() #end
			            if ($converter != null)
		                {
		                    $value = ${converter}.convert(stringValue);
		                }
		            }
		        }
		    }
		}
    #end
    if ($value != null) 
    {
        #assignValue()
    }
}

#parse("name/pehl/piriti/rebind/xml/reader/property/commons.vm")
#set($elements = $property.variables.newVariable("Elements"))
#set($asList = $property.variables.newVariable("AsList"))
#set($elementType = $property.elementType.parameterizedQualifiedSourceName)
#if ($property.elementType.isPrimitive())
    #set($boxedElementType = $property.elementType.qualifiedBoxedSourceName)
#else
    #set($boxedElementType = $elementType)
#end
#newConcreteTypes()
List<Element> $elements = filterElements(element.selectNodes("$property.pathOrName"));
if (!${elements}.isEmpty())
{
    List<$boxedElementType> $asList = new ArrayList<$boxedElementType>(${elements}.size());
    Converter<$boxedElementType> $converter = null;
    #if ($property.converter) #customConverter() #else #defaultConverter($boxedElementType) #end
    for (Element currentElement : $elements)
    {
        #set($currentValue = $property.variables.newVariable("CurrentValue"))
        $boxedElementType $currentValue = null;
        #parse($property.elementTypeTemplate)
        if ($currentValue != null) 
        {
            ${asList}.add($currentValue);
        }
    }
    int index = 0;
    $value = new ${elementType}[${asList}.size()];
    for ($boxedElementType tmpValue : $asList)
    {
        ${value}[index++] = tmpValue;
    }
}
if ($value != null) 
{
    #assignValue()
}
